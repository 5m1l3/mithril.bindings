<html>
<head>
	<title></title>
	<script src="../mithril.js/mithril.js"></script>
	<script src="mithril.bindings.js"></script>
	<style>
		.done { text-decoration: line-through; }
	</style>
</head>
<body>

<div id="content"></div>

<script>
//	Basic todo app
var app = {
	model: function() {
		this.todos = m.p([
			{ text: "learn mithril", done: m.p(true) },
      		{ text: "build a mithril app", done: m.p(false) }
      	]);
      	this.input = m.p("");
	},
	controller: function() {
		var model = this.model = new app.model();
		this.addTodo = function(){
			var value = model.input();
			if(value) {
				model.todos.push({text: model.input(), done: m.p(false)});
				model.input("");
			}
			return false;
		};
		this.left = function(){
			var count = 0;
			model.todos().map(function(todo) {
				count += todo.done() ? 0 : 1;
			});
			return count;
		};
		this.archive = function(){
			var list = [];
			model.todos().map(function(todo) {
				if(!todo.done()) { list.push(todo); }
			});
			model.todos(list);
		};
	},
	view: function(data) {
		var t = data.model;
		return [
			m("h1", "Mithril bindings test Todos - " + data.left() + " of " + t.todos().length + " remaining"),
			m("button", { onclick: data.archive }, "Archive"),
			m("ul", [
				t.todos().map(function(todo, idx){
					return m("li", { class: todo.done()? "done": "", toggle: todo.done }, todo.text );
				})
			]),
			m("form", { onsubmit: data.addTodo }, [
				m("input", { type: "text", value: t.input, size: 30, placeholder: "Add todo"}),
				m("button", { type: "submit"}, "Add")
			])
		];
	}
};

//initialize
m.module(document.getElementById("content"), app);
</script>

</body>
</html>